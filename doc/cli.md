# Command Line Interface (CLI)

KPConv-Torch is a library with a *command-line interface* (CLI). It works for training a neural network model on a points cloud dataset. 

> Until now, only compatibility with the [S3DIS dataset](https://guochengqian.github.io/PointNeXt/examples/s3dis/) has been developed. 

The following options are available, behind the command `kpconv`:
- `preprocess`;
- `train`;
- `test`.

They are detailed below.


## Preprocess

The `preprocess` command corresponds to the preprocessing of the data labeled files, used for training the model, with the following options:  
- `-s` or `--dataset`: dataset name (default = `"S3DIS"`);  
- `-d` or `--datapath`: path to the labeled points clouds data files.

The `preprocess` command generates two folders, inside the folder pointed by the `-d` option:  
- `input_xxxx`, which contains the KD-trees files (`.pkl`) and the conversion of the points clouds for each area in a unique `.ply` file (`xxxx` being a parameter of the program);  
- `original_ply`, which contains a copy of each generated points clouds `.ply` file.


## Train

The `train` command corresponds to the training of the model. The following options can be used with it:
- `-s` or `--dataset`: dataset name (default = "S3DIS");
- `-d` or `--datapath`: path to the folder of labeled points clouds data files, which should contain the `input_xxxx` and the `original_ply` folders, generated by the preprocessing step (mandatory);
- `-l` or `--chosen-log`: path to an already trained KPConv model log folder on the file system (mutually exclusive with the `-o` option);
- `-o` or `--output-folder`: path to a folder which will contain the new KPConv model log folder on the file system (mutually exclusive with the `-l` option).

The `train` command generates :
- a `parameters.txt` file containing a summary of the parameters of the calibration and of the calibrated model;  
- a `training.txt` file containing an accuracy measure and a calculation time, for each epoch (iteration) of the training;  
- a `val_IoUs.txt` file, containing the values of a validation indicator called *intersection over union*, that compares for each semantic class the ground truth and the predictions.  
    - The ratio tends toward 1 (meaning that intersection tends toward union) when the predictions are good. 
    - When the predictions are bad, the intersection tends to be empty and the ratio tends to 0.
- a `checkpoints` folder, containing `.tar` files, corresponding to the different epochs;
- a `potentials` folder, containing an `Area_5.ply` file, with validation data inside.


## Test

The `test` command corresponds to the application of the model on an unlabeled dataset. The following options are available with it:
- `-s` or `--dataset`: dataset name (default = "S3DIS");  
- `-d` or `--datapath` (mandatory):  
    - path to the folder of labeled points clouds data files used to train the model, which should contain two folders, generated by the preprocessing step:  
        - `input_xxxx`;  
        - `original_ply`;  
- `-l` or `--chosen-log`: path of the KPConv log folder on the file system, in which will be stored the trained model (mandatory);  
- `-f` or `--filename`: file on which to predict semantic labels, using the trained model (optional).

The `test` command generates:
- two files, in the folder pointed by the `-d` option, containing the data used to train the model:
    - `batch_limits.pkl`: ;
    - `neighbors_limits.pkl`: ;
- three folders, in the folder pointed by the `-l` option, containing the trained model:
    - `potentials`: ;
    - `predictions`: predictions for point, based on the highest probability;
    - `probs`: probability that each point belongs to each class of the nomenclature.

Original code from Hugues Thomas has two more modules, `visualize.py` and `plot_convergence.py`, which are not included in the CLI. Nevertheless, they are not maintained in the version of the library contained in this repository.
