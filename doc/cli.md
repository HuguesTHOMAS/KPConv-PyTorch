
KPConv-Torch is a library with a *command-line interface* (CLI). 

It works for training a neural network model on the [S3DIS dataset](https://guochengqian.github.io/PointNeXt/examples/s3dis/). The following options are available, behind the command `kpconv`:

- `preprocess`: corresponds to the preprocessing of the data labeled files, used for training the model
    - `-s` or `--dataset`: dataset name (default = "S3DIS")    
    - `-d` or `--datapath`: path to the labeled points clouds data files
        The pointed folder must contain a tree architecture having the following organisation, for each sample area $x$ and each room of type $y$.

        ```bash
        Area_x
        ├── Annotations
        │   ├── cat-z_m.txt
        └── room-type-y_n.txt
        ```
        
        `room-type-y_n.txt` is the file containing all (unlabeled) data points describing the room. $y$ is a user-defined room type.

        `cat-s_m.txt` is a file containing the labeled data points corresponding to the $z$ object category, taken among one of the following:
        - 0: ceiling;
        - 1: floor;
        - 2: wall;
        - 3: beam;
        - 4: column;
        - 5: window;
        - 6: door;
        - 7: chair;
        - 8: table;
        - 9: bookcase;
        - 10: sofa;
        - 11: board;
        - 12: clutter.

        There are $M$ `cat-z_m.txt` files, each one corresponding to one labeled object and $m$  varying from 1 to $M$.

    - Ouputs: the `preprocess` command generates two folders, inside the folder pointed by the `-d` option:
        - `input_0.030`, which contains the KD-trees files (`.plk`) and the conversion of the points clouds for each area in a unique `.ply` file;
        - `original_ply`, which contains a copy of each generated points clouds `.ply` file.

- `train`: corresponds to the training of the model;
    - `-s` or `--dataset`: dataset name (default = "S3DIS");
    - `-d` or `--datapath`: path to the folder of labeled points clouds data files, which should contain the `input_0.030` and the `original_ply` folders, generated by the preprocessing step ;
    - `-l` or `--chosenlog`: path of the KPConv log folder on the file system, in which will be stored the trained model.

    - Outputs: the `train` command generates :
        - a `parameters.txt` file containing a summary of the parameters of the calibration and of the calibrated model;
        - a `training.txt` file containing an accuracy measure and a calculation time, for each epoch (iteration) of the training;
        - a `val_IoUs.txt` file, containing ??;
        - a `checkpoints` folder, containing `.tar` files, corresponding to the different epochs;
        - a `potentials` folder, containing an `Area_5.ply` file, with validation data inside.

- `test`: corresponds to the training of the model;
    - `-s` or `--dataset`: dataset name (default = "S3DIS");
    - `-d` or `--datapath`: 
        - path to the folder of labeled points clouds data files used to train the model, which should contain two folders, generated by the preprocessing step:
            - `input_0.030`;
            - `original_ply`;
    - `-l` or `--chosenlog`: path of the KPConv log folder on the file system, in which will be stored the trained model;
    - `-f` or `--filename`: file on which to predict semantic labels, using the trained model.

    - Outputs: the `test` command generates:
        - two files, in the folder pointed by the `-d` option, containing the data used to train the model:
            - `batch_limits.pkl`: ;
            - `neighbors_limits.pkl`: ;
        - three folders, in the folder pointed by the `-l` option, containing the trained model:
            - `potentials`: ;
            - `predictions`: predictions for point, based on the highest probability;
            - `probs`: probability that each point belongs to each class of the nomenclature.

Original code from Hugues Thomas has two more modules, `visualize.py` and `plot_convergence.py`. Nevertheless, they are not maintained in the version of the library contained in this repository.
